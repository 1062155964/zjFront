<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>实测实量</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../css/mui.min.css">
		<link rel="stylesheet" href="../css/my_css.css">
		<style type="text/css">
			.margintop10px {
				margin-top: 10px;
			}
			
			.paddingleft34px { 
				padding-left: 34px;
			}
			
			.mui-popover {
				height: 260px;
			}
			
			#cdbzPopover {
				min-width: 282px;
				top: 15% !important;
				margin-top: 0px;
				left: 50% !important;
				margin-left: -141px;
				position: fixed;
			}
			
			.mui-popover .mui-popover-arrow {
				display: none !important;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">我的工程</h1>
		</header>
		
		<div class="mui-content my_none">
			<div id="myform" class="">
				<div class="mui-content-padded" style="margin: 5px;">
					<form class="mui-input-group">
						<div class="mui-input-row">
							<label>纬度：</label>
							<input id="weidu" type="text" class="mui-input-clear" placeholder="纬度">
						</div>
						<div class="mui-input-row">
							<label>经度：</label>
							<input id="jingdu" type="text" class="mui-input-clear" placeholder="经度">
						</div>
						<div class="mui-input-row">
							<label>电话：</label>
							<input id="phone" type="text" class="mui-input-clear" placeholder="电话">
						</div>
						<div class="mui-input-row">
							<label>工程id：</label>
							<input id="gcidCf" type="text" class="mui-input-clear" placeholder="工程id">
						</div>
						<div class="mui-input-row">
							<label>姓名：</label>
							<input id="nameXm" type="text" class="mui-input-clear" placeholder="姓名">
						</div>
						<div class="mui-input-row">
							<label>部门：</label>
							<input id="bumen1" type="text" class="mui-input-clear" placeholder="部门">
						</div>
						<div class="mui-input-row">
							<label>时间：</label>
							<input id="qdTime" type="text" class="mui-input-clear" placeholder="时间">
						</div>
					</form>
				</div>
			</div>
		</div>
		
		<div id="gongcheng" class="mui-content ">
		
		</div>
		<script src="../js/mui.min.js"></script>
		<script src="../js/service.js"></script>
		<script>
			mui.plusReady(function() {
				
				var self = plus.webview.currentWebview();
				mobile = self.mobile;
				userid = self.zhi;
				bumen = self.bumen;
				
				var a = document.getElementsByTagName("a");
				
				var phone = document.getElementById("phone");
				var gcidCf = document.getElementById("gcidCf");
				var nameXm = document.getElementById("nameXm");
				var gongcheng = document.getElementById("gongcheng");
				var bumen1 = document.getElementById("bumen1");
				var qdTime = document.getElementById("qdTime");
				
				bumen1.value = bumen;
				phone.value = mobile;
				
				//获取当前时间
				var date = new Date();
				var year = date.getFullYear(); //获取当前年份
				var mon = date.getMonth() + 1; //获取当前月份    
				var da = date.getDate(); //获取当前日    
				var day = date.getDay(); //获取当前星期几    
				var h = date.getHours(); //获取小时    
				var m = date.getMinutes(); //获取分钟  
				if(da<10){
					var time01 = year + "-%" + mon + "-0" + da;
				} else {
					var time01 = year + "-%" + mon + "-" + da;
				}
				qdTime.value = time01;
				
				//动态创建
				var myproject = function(id, gcname, dq, xmlb, gczt, i) {
					//					alert(gcname);
					var id = id;
					var gcmc = gcname;
					var dq = dq;
					var xmlb = xmlb;
					var gczt = gczt;
					var num = i;
					//				alert(gcmc);

					var gcmc_c = encodeURI(encodeURI(gcmc));
					var dq_c = encodeURI(encodeURI(dq));
					var xmlb_c = encodeURI(encodeURI(xmlb));
					var gczt_c = encodeURI(encodeURI(gczt));

					var zhuyi = "本工程存在3项工程通病超警戒";
					var chakan = "本月存在项日志信息卡片";
					var diqu = "地区：" + dq;
					var an1 = '点击查看';
					var an2 = '进入工程';

					var gongcheng = document.getElementById("gongcheng");
					var div = document.createElement("div");
					div.className = "mui-mui-table-view my_list mui-card margintop10px";
					div.style = "margin-top: 10px";
					div.id = "div" + id + "num" + i; 

					var muicontent = document.getElementsByClassName('mui-content');
					var div = document.createElement('div');
					div.className = 'mui-card margintop10px';
					gongcheng.appendChild(div);
					var ul = document.createElement('ul');
					ul.className = 'mui-table-view my_list';
					div.appendChild(ul);
					var li = document.createElement('li');
					li.className = 'mui-table-view-cell mui-media my_backgroundcolor_blue my_color_white';
					ul.appendChild(li);
					var a = document.createElement('a');
					a.href = "my_project.html?id=" + id + "&gcmc=" + gcmc_c + "&dq=" + dq_c + "&xmlb=" + xmlb_c + "&gczt=" + gczt_c+ "&mobile=" + mobile;
					li.appendChild(a);
					var img = document.createElement('img');
					img.className = 'mui-media-object mui-pull-right';
					img.src = '../images/xmmc.png';
					a.appendChild(img);
					var div2 = document.createElement('div');
					div2.className = 'mui-media-body';
					a.appendChild(div2);
					var txt = document.createTextNode(gcmc);
					div2.appendChild(txt);
					var p = document.createElement('p');
					p.className = 'mui-ellipsis my_color_white';
					div2.appendChild(p);
					var txt2 = document.createTextNode(diqu);
					p.appendChild(txt2);
					var p2 = document.createElement('p');
					p2.className = 'mui-ellipsis my_underline my_color_white';
					div2.appendChild(p2);
					var txt3 = document.createTextNode(an2);
					p2.appendChild(txt3);

					var li2 = document.createElement('li');
					li2.className = 'mui-table-view-cell mui-media';
					ul.appendChild(li2);
					var a2 = document.createElement('a');
					li2.appendChild(a2);
					var div3 = document.createElement('div');
					div3.className = 'mui-media-body';
					a2.appendChild(div3);
					var span = document.createElement('span');
					span.className = 'mui-icon mui-icon-spinner-cycle mui-pull-left';
					div3.appendChild(span);
					var button = document.createElement('button');	
					button.className = 'mui-btn mui-btn-warning mui-pull-right';
					button.type = 'button';
					div3.appendChild(button);
					var txt4 = document.createTextNode(an1);
					button.appendChild(txt4);
					var p3 = document.createElement('p');
					p3.className = 'mui-ellipsis my_fontsize my_color_blue my_paddingleft';
					div3.appendChild(p3);
					var txt5 = document.createTextNode(zhuyi);
					p3.appendChild(txt5);
					var a3 = document.createElement('a');
					li2.appendChild(a3);
					var div4 = document.createElement('div');
					div4.className = 'mui-media-body';
					a3.appendChild(div4);
					var span2 = document.createElement('span');
					span2.className = 'mui-icon mui-icon-info mui-pull-left';
					div4.appendChild(span2);
					var button2 = document.createElement('button');
					button2.className = 'mui-btn mui-btn-warning mui-pull-right';
					button2.type = 'button';
					div4.appendChild(button2);
					var txt6 = document.createTextNode(an1);
					button2.appendChild(txt6);
					var p4 = document.createElement('p');
					p4.className = 'mui-ellipsis my_fontsize my_color_blue my_paddingleft';
					div4.appendChild(p4);
					var txt7 = document.createTextNode(chakan);
					p4.appendChild(txt7);
				}
				//异步传值
				mui.ajax(url + 'my_plus/my_project_list.php', {
					data: {

					},
					dataType: 'json',
					type: 'POST',
					timeout: 10000,
					success: function(data) {
						var length = data.length;
						if(length > 1) {
							for(var i = 0; i < length - 1; i++) {
								var id = data[i].id;
								var gcname = data[i].工程名称;
								var dq = data[i].地区;
								var xmlb = data[i].项目类别;
								var gczt = data[i].工程状态;
								myproject(id, gcname, dq, xmlb, gczt, i);
								//	alert(gcname);
							}
						} else {
							alert("暂无数据");
						}
					},
					error: function(xhr, type, errorThrown) {
						alert('ajax错误' + type + '---' + errorThrown);
					}

				});
			});
		</script>
		<script src="../js/setPullToRefresh.js"></script>
	</body>

</html>